<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Live HTML/CSS/JS Sandbox</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden; /* prevent page scrolling */
      }
      iframe#sandbox {
        width: 100%;
        height: 100%;
        overflow-y: auto;
        border: none;
      }
    </style>
  </head>
  <body>
    <iframe id="sandbox" sandbox="allow-scripts allow-same-origin"></iframe>
    <script>
      const sandbox = document.getElementById("sandbox");
      let html = `
        <div style="display: flex; justify-content: space-evenly;">
          <label>
            <p>HTML: <span id="htmlButton">Update</span></p>
            <textarea id="html" placeholder="Enter HTML here"></textarea>
          </label>
          <label>
            <p>CSS: <span id="cssButton">Update</span></p>
            <textarea id="css" placeholder="Enter CSS here"></textarea>
          </label>
          <label>
            <p>JavaScript: <span id="jsButton">Update</span></p>
            <textarea id="js" placeholder="Enter JavaScript here"></textarea>
          </label>
        </div>
      `;
      let css = `
        body {
          font-family: sans-serif;
          display: flex;
          flex-direction: column;
          align-items: stretch;
          gap: 10px;
        }
        textarea {
          width: 25svw;
          height: 90svh;
          font-family: monospace;
          resize: vertical;
          padding: 8px;
          box-sizing: border-box;
          border: 1px solid #ccc;
          border-radius: 4px;
        }
        label {
          display: flex;
          flex-direction: column;
          font-weight: bold;
        }
        p, span {
          margin: 0;
        }
        
        span {
          background: #ccc;
          border-radius:4px;
        }

        span:hover {
          background: #999;
        }
      `;
      let js = `
        const htmlInput = document.getElementById("html");
        const htmlButton = document.getElementById("htmlButton");
        const cssInput = document.getElementById("css");
        const cssButton = document.getElementById("cssButton");
        const jsInput = document.getElementById("js");
        const jsButton = document.getElementById("jsButton");

        const sandbox = document.getElementById("sandbox");
        htmlInput.value = parent.getHTML();
        cssInput.value = parent.getCSS();
        jsInput.value = parent.getJS();

        htmlButton.addEventListener("click", () => parent.setHTML(htmlInput.value));
        cssButton.addEventListener("click", () => parent.setHTML(cssInput.value));
        jsButton.addEventListener("click", () => parent.setHTML(jsInput.value));
      `;

      window.getHTML = () => html;
      window.getCSS = () => css;
      window.getJS = () => js;

      window.setHTML = (value) => {
        if (html === value) return;
        html = value;
        updateSandbox();
      };
      window.setCSS = (value) => {
        if (css === value) return;
        css = value;
        updateSandbox();
      };
      window.setJS = (value) => {
        if (js === value) return;
        js = value;
        updateSandbox();
      };

      function updateSandbox() {
        const doc = `
          <html>
            <head>
              <style>${css}</style>
            </head>
            <body>
              ${html}
              <script>${js}<\/script>
            </body>
          </html>
        `.trim();

        sandbox.srcdoc = doc;
      }

      // Initialize sandbox
      updateSandbox();
    </script>
  </body>
</html>
